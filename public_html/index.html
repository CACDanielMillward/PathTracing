<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>
    </head>
    <body>
        <p id='testing'>TODO write content</p>
        <canvas id="myCanvas" width="100" height="100" style="border:1px solid #d3d3d3;">
            Your browser does not support the HTML5 canvas tag.</canvas>
        <br></br>
          <script src='scene.js'></script>
           <script src='ray.js'></script>
        <script src='tracer.js'></script>
        <script src='camerastuff.js'></script>
     
        <script>
//            
//            var testCamera = new Camera();
//            var raything = testCamera.generateRay(1,1); // new ray from camera
//            console.log("x value: " + math.subset(raything.direction, math.index(0)));

//            
//            
//                // Pick a random direction from here and keep going.
//    var newRayOrigin = raything.pointWhereObjectWasHit();
//    
//    
//    // This is NOT a cosine-weighted distribution!
//    var newRayDirection = RandomUnitVectorInHemisphereOf(raything.normalWhereObjWasHit());
//    
//    var newRay = new Ray(newRayOrigin, newRayDirection); // new ray from sphere
//    
//    console.log("HTML newray: " + Ray);
//    
//    
//    
//            //thing.innerHTML = raything.pointWhereObjectWasHit();
 //          thing.innerHTML = BRDF(0.9,0.9,raything.direction, newRayDirection, raything.normalWhereObjWasHit());




//var maxWidth = 100;
//var maxHeight = 100;
//var maxSamples = 1;
//
//var theFinalPicture = Render(maxWidth, maxHeight, maxSamples);

var testingCamera = new Camera();
var maximumDepth = 25;
//var pictureArray = new Array(10); // width
//
//for (var m = 0; m < pictureArray.length; m++) {
//             pictureArray[m] = new Array(10); // height
//    }


function newRender(camera, picArray) {
  
}

function UrMOM() { // actual Array?
    var pictureArray = new Array(100); // width

for (var m = 0; m < pictureArray.length; m++) {
             pictureArray[m] = new Array(100); // height
    }
 
    
      for (var i = 0; i < 100; i++) {
        for (var j = 0; j < 100; j++) {
            for (var k = 0; k < maximumDepth; k++) {
                                            var testingRay = testingCamera.generateRay(i,j);
            var testingOne = tracing(testingRay, 0);
            
            //pictureArray[i][j] = pictureArray[i][j] + testingOne;
            if (!isNaN(pictureArray[i][j])) { // if it's a number, add to self
             pictureArray[i][j] = pictureArray[i][j] + testingOne;
         } else {
             pictureArray[i][j] = testingOne;
         }
            }

            pictureArray[i][j] = pictureArray[i][j] / maximumDepth;
        }
    }
                   console.log("THe array: " + pictureArray);
return pictureArray;
    };
    
var newtestOne = UrMOM();
        
console.log("#1:"+ newtestOne);

            var thing = document.getElementById('testing');

var strArray = ""; // displaying it as a text arrray
for (var i = 0; i < newtestOne.length; i++){
                strArray += newtestOne[i] + '<br />';
        }
document.write(strArray);


thing.innerHTML = "Done.";
console.log("#2:"+ newtestOne);
//
//
//
//

var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
var imgData = ctx.createImageData(100, 100);
console.log("#3:"+ newtestOne);
var maxValThing = 0;
//TODO: set array to go from 0 to 255
for (var r = 0; r < newtestOne.length; r++) {
    for (var e = 0; e < 100; e++) {
        if (newtestOne[r][e] > maxValThing) {
            maxValThing = newtestOne[r][e];
        }
    }
}
console.log("After first: "+ newtestOne);
for (var r = 0; r < newtestOne.length; r++) {
    for (var e = 0; e < 100; e++) {
        var toMultiplyBy = 255 / maxValThing;
        newtestOne[r][e] = newtestOne[r][e] * toMultiplyBy;
    }
}
console.log("After second: "+ newtestOne);

var flattenedArray = newtestOne.reduce((newtestOne, val) => newtestOne.concat(val), []);
console.log("Flat: " + flattenedArray);
console.log("NOt flat: "+ newtestOne);
var t;
for (t = 0; t < imgData.data.length; t += 4) {
    var theNumber = t/4;
    
    
  imgData.data[t+0] = flattenedArray[theNumber];
  imgData.data[t+1] = flattenedArray[theNumber];
  imgData.data[t+2] = flattenedArray[theNumber];
  imgData.data[t+3] = 255;
}

ctx.putImageData(imgData, 0, 0);

            </script>
    </body>
</html>
